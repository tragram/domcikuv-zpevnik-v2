# Domčíkův Zpěvník v2
Welcome to the source code of my songbook, [available on Github Pages](https://tragram.github.io/domcikuv-zpevnik-v2/). It shows most of the songs I play without complaining and offers searching, filtering and sorting, as well as random song generation, transpositions etc.
## Previous version
For my high-school graduation project, I created the first version of this songbook, [hosted here](https://appelt.cz/domcikuvzpevnik/). It consisted of an [Android app](https://github.com/tragram/DomcikuvZpevnik) and a [PHP server](https://github.com/tragram/DomcikuvZpevnik-Server). Due to a lack of updates, the app was taken down from the Playstore by Google in 2024 and the website was suboptimal for viewing on mobile devices, which is the main use-case of the songbook. Since I no longer program in Java nor PHP, I decided to make a new version, so here we are.

## Editing songs
To edit a song, you can directly edit the source. Any push to the `main` branch triggers a new build of the website and the changes should be live in about 1 minute. If you don't have the necessary rights, you will have to make a pull request or let me know. ;)

The songs are defined in the [ChordPro](https://www.chordpro.org/chordpro/chordpro-introduction/) format located in `songs/` and shows them on the website. For clarity, the songs are named in the form `artist_name-song_name.pro` with any special characters converted to ASCII. There is no need to do this manually, you can just run the `format_songs.py` script to do it for you.

A song should have the following entries:
```chordpro
{artist: František Vomáčka}
{title: Svíčková}
{language: english}
{date_added: 02-2020}
{capo: 0}
{key: C}
{range: c1-f#2}
{tempo: 110}
```

Note that this project assumes the Czech/German note naming scheme, where the notes go as follows: `C C#/Des D D#/Es E F F#/Ges G G#/As A A#/B H C`.

### Extensions of the ChordPro format
Despite the ChordPro format being the only widely used, the specification lacks many nice-to-have features. For convenience, I have added the possibility to keep in memory more than one chorus. You can define the name of the chorus (note: it will be displayed!) in the directive by e.g. 
```chordpro
{start_of_chorus: R1}
content
{end_of_chorus}
{start_of_chorus: R2}
content
{end_of_chorus}
```
and them later recall them by 
```
{chorus: R1}
{chorus: R2}
{chorus: R1}
```
This is compatible with the feature that hides repeated choruses (it will then just show the name of the chorus for reference).

### Image generation
Since it's 2024, I decided to use AI for tasks other than helping me code this thing. The `generate_images.py` script loads the lyrics of each of the songs and generates a prompt (in English) for an image generation model.

Because the songs are in many languages, it's currently (October 2024) necessary to use GPT-4o to generate the prompt based on the lyrics, as it has by far the best multilingual capabilities for random languages like Czech, Slovak, Finnish or Estonian. By default, the script uses GPT-4o-mini which still provides very satisfactory results (you can see for yourself in `songs/image_prompts`) at a fraction of the cost (around 0.01USD/10 songs). 

Generating the prompt in English allows us to use any old image generation network. Because DALL-E 3 is pretty expensive (0.040-0.080$/image) and can only generate images that are 1024×1024 which is too large, I decided to just use the free [Hugging Face](https://huggingface.co/) API. In particular, I landed on the [FLUX.1-dev](https://huggingface.co/black-forest-labs/FLUX.1-dev) model.

To use the script, you need to provide your own `secrets.yaml` file with your API keys in the following format:
```yaml
hugging_face_token: YOUR_TOKEN
openai:
  api_key: YOUR_TOKEN
  organization_id: YOUR_ORG_ID
  project_id: YOUR_PROJECT_ID
```

For fun, I asked ChatGPT to generate a logo for this project. Well, let's just say that while letters in English have improved a lot, it still have issues with foreign letters.

<img src="dalle_logo.webp" title="Logo generated by DALL-E 3" width="300">

## Tech
Website built on React+Vite, styled by [TailwindCSS](https://tailwindcss.com) and [NextUI](https://nextui.org) and uses the following libraries:
* [Lucide](https://lucide.dev/): icons
* [ChordSheetJS](https://github.com/martijnversluis/ChordSheetJS): parsing Chordpro in JS
* [Fuse.js](https://www.fusejs.io/): fuzzy search

## TODO:
A lot ATM.